<style>
/* скрыть watermark слева */
.watermark.leftwatermark { display: none !important; }

/* часто еще есть правый watermark/brand */
.watermark.rightwatermark,
.branding { display: none !important; }
</style>

<div class="mz-card" style="padding:16px 16px 14px;">
  <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
    <div>
      <h4 style="margin:0;">Clase en directo</h4>
      <div class="mzc-note" style="margin-top:6px;">
        <span>Servidor: <b>{{ jitsi_domain }}</b></span>
        <span class="dot"></span>
        <span>Sala: <code>{{ jitsi_room }}</code></span>
      </div>

	  	  <div class="mzc-note">
  is_teacher={{ is_teacher }} · jwt={{ jitsi_jwt|yesno:"YES,NO" }}
</div>
    </div>

    <div style="display:flex; gap:8px; align-items:center;">
      <button class="mzc-btn ghost" id="mz-jitsi-reload">Recargar</button>
      <button class="mzc-btn" id="mz-jitsi-leave">Salir</button>
    </div>
  </div>

  <div id="mz-jitsi-root"
       style="margin-top:12px; width:100%; height: calc(100vh - 340px); min-height:520px; border-radius:16px; overflow:hidden; border:1px solid rgba(148,163,184,0.35);">
  </div>
</div>
<script src="https://{{ jitsi_domain }}/external_api.js"></script>
<script>
(() => {
  const domain = "{{ jitsi_domain|escapejs }}";
  const roomName = "{{ jitsi_room|escapejs }}";
  const displayName = "{{ jitsi_display_name|escapejs }}";
  const jwtToken = "{{ jitsi_jwt|default:''|escapejs }}";

  const root = document.querySelector('#mz-jitsi-root');
  if (!root) {
    console.error('[JITSI] root not found (#mz-jitsi-root)');
    return;
  }

  const options = {
    roomName,
    parentNode: root,
    width: '100%',
    height: '100%',
    userInfo: { displayName },
    ...(jwtToken ? { jwt: jwtToken } : {}),
    configOverwrite: {
      prejoinPageEnabled: true,
      disableDeepLinking: true,
      enableUserRolesBasedOnToken: true,
    },
  };

  const api = new JitsiMeetExternalAPI(domain, options);

  document.getElementById('mz-jitsi-leave')?.addEventListener('click', () => {
    api.executeCommand('hangup');
  });

  document.getElementById('mz-jitsi-reload')?.addEventListener('click', () => {
    api.dispose();
    location.reload();
  });
})();
</script>